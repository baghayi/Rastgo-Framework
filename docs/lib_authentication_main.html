<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>مستندات فریمورک راستگو</title>
  <meta name="description" content="The documentation of the Rastgo Framework" />
  <meta name="author" content="Rastgo Framework" />

  <meta name="viewport" content="width=device-width; initial-scale=1.0" />
  <link href="includes/stylesheet.css" rel="stylesheet" type="text/css" />
  <script src="includes/javascript.js" type="text/javascript"></script>
</head>

<body>
  <div>
    <header>
      <h1 id="title" title='Authentication'>Authentication</h1>
    </header>
    
    <nav>
      <h3><a href="index.html">صفحه اصلی</a></h3>
      <h3><a href="library.html">کتابخانه فریمورک</a></h3>
      <h3><a href="core.html">هسته فریمورک</a></h3>
      <h3><a href="others.html">بخش های دیگر</a></h3>
    </nav>

    <section id='content'>
    	<article>
    		<header>
    			<h3>فهرست</h3>
    		</header>
    		
    		<ul>
	      		<li><a href="#mainclass" alt="index.php (کلاس اصلی)">index.php (کلاس اصلی)</a></li>
	      		<li><a href="#sample" alt="sample/authenticationController.php (نمونه مثال از کلاس)">sample/authenticationController.php (نمونه مثال از کلاس)</a></li>
	      	</ul>
    	</article>
      
      <article>
      	<header>
      		<h3>توضیحات</h3>
      	</header>
      	
      		<a name="mainclass" id="mainclass"></a>
     		<h4>index.php (کلاس اصلی)</h4>
      		<p>کلاس Authentication برای احراز هویت و ثبت نام کاربر جدید و ورود کاربر از طریق فرم HTML یا از طریق کوکی سشن و … استفاده می شه.</p>
      		<p>Namespace کلاس root\library\Authentication\index هست.</p>
      		
      		<h5>- پروپرتی ها</h5>
      		<p>همه پروپرتی های کلاس private هستن.</p>
      		<p>$sessionInstance برای ذخیره آبجکت کلاس SessionDB هست.</p>
      		<p>$dbTableName برای ذخیره اسم جدول دیتابیس. مقدار پیشفرض authentication هست.</p>
      		<p>$pepper برای ذخیره ادویه D: - همون salt خودمون که به این اسم گذاشتم که با اون یکی salt ای که خواهیم داشت تداخل ایجاد نشه. و برای امنیت بیشتر بهتره این پروپرتی هم توسط متد initPepper() تعیین بشه که هش پسورد قوی‌تر بشه.</p>
      		<p>$dbHashColumnName برای ذخیره اسم ستون ای که قراره هش پسورد توش ذخیره بشه. که مقدار پیشفرض pass_hash هست.</p>
      		<p>$dbSaltColumnName برای ذخیره اسم ستون ای که قراره salt پسورد توش ذخیره بشه. Salt ای که منحصرا برای هر پسورد یکتاست و salt هر پسورد با دیگری تفاوت داره (حالا اگرم تکراری باشه درصدش پایینه و مشکلی نیست). مقدار پیش‌فرض pass_salt هست.</p>
      		<p>$userIdentifier برای ذخیره شناسه ای که ازش می شه کاربر رو شناسایی کرد. چیزی مثل نام کاربری یا ایمیل که یکتا هم باشه.</p>
      		<p>$dbUserIdentifierColumnName برای ذخیره اسم ستون ای (در دیتابیس) که شناسه یکتای کاربر توش ذخیره شده. اسم ستون (مثلاً: نام کاربری یا ایمیل یا … که برای شناسایی کاربر استفاده می شه)</p>
      		<p>$sessionId برای ذخیره ای دی سشن هستش.</p>
      		<p>$dbSessionIdColumnName برای ذخیره نام ستون (در دیتابیس) ای دی سشن که قراره توش ذخیره بشه. (مقدار پیش‌فرض session_id هستش)</p>
      		
      		<h5>- متد ها</h5>
      		<p>- __construct متد سازنده مون که دارای یک پارامتر هست و در صورتی که true تعیین بشه مقادیر فارسی به درستی در دیتابیس ذخیره می شه.</p>
      		<hr />
      		<p>- loginViaCookie در صورتی که قبلاً کاربر از طریق فرم ورود وارد شده باشه و کوکی ای براش تعیین شده باشه برای دفعات بعدی (مثلاً در صفحه معمولی) از این متد می شه برای احرازهویت کاربر استفاده کرد و در صورتی که کاربر معتبر باشه مقدار ۱ برگشت می ده و در غیراینصورت مقدار 0 برمی گردونه. هیچ پارامتری هم نداره.</p>
      		<hr />
      		<p>- loginViaUserRawInfo جهت ورود برای اولین بار استفاده می شه تا کوکی شسن ایجاد بشه و از دفعات بعدی می شه از متد LoginViaCookie بجاش استفاده کرد (البته تا زمانی که کوکی از بین نرفته).</p>
      		<p>پارامتر اولش باید آرایه ای باشه که شامل ۲ مورد: نام کاربری و کلمه عبور – توجه کنید که باید کلید آرایه رو هم با اسم ستون جدول دیتابیس پر کنید .<br /> به عنوان مثال: </p>
      		<pre class="ltr">
array( 
	'username' => 'MYuNIQUEuSERNAME', 
	'password' => 'MYpASSWORD' 
);
      		</pre>
      		<p>پارامتر دوم در صورتی که true تعیین بشه، هنگام ورود IP کاربر هم چک خواهد شد و به IP کاربر حساس خواهد بود. (مقدار پیش‌فرض false هست )</p>
      		<p>پارامتر سوم در صورتی که true تعیین بشه، هنگام ورود به نوع مرورگر کاربر حساس خواهد بود و نوع مرورگر هم چک خواهد شد که همان مرورگری باشه که هنگام ورود اولیه ثبت شده بود. (مقدار پیش‌فرض false هست )</p>
      		<p>و در صورت ورود موفقیت آمیز مقدار ۱ برگشت داده می شه و غیراینصورت مقدار 0 برگشت داده می شه.</p>
      		<hr />
      		<p>- userIdentifierExists این متد به ما این اجازه رو می ده که بتونیم چک کنیم که آیا کاربرمون وجود داره یا نه. و البته توسط ستونی که مقدارش برای هر کاربر یکتاست (مثل نام کاربری، ایمیل یا …).</p>
      		<p>پارامتر اول این متد باید آرایه ای باشه و یک مقدار هم داشه باشه (چون در حال حاضر امکان چک کردن یک کاربر رو به ما می ده). کلید آرایه باید هم اسم ستون جدول دیتابیس باشه و مقدارش هم (نام کاربری، ایمیل یا …) باید باشه. مثل: </p>
      		<pre class="ltr">
array(
	'username' => 'MYuNIQUEuSERNAME',
);
      		</pre>
      		<p>در صورتی که کاربر وجود داشته باشه مقدار 1 برگشت داده می شه و در صورت ناموفق بودن یا نبودن کاربر مقدار 0 برگشت داده می شه.</p>
      		<hr />
      		<p>- setSession متد private هست و در حقیقت وظیفش ایجاد کوکی و کاراهای مرتبط با سشن رو انجام می ده و مقادیر رو ثبت می کنه که نیازی برای کار باهاش نیست.</p>
      		<hr />
			<p>- updateDBSessionId هم متد private و برای آپدیت سشن آی دی در دیتابیس بکار می ره و ما نیازی برای کار باهاش نخواهیم داشت.</p>
			<hr />
			<p>- makePassHashMD5 برای ایجاد salt برای کلمه عبورمون و همچنین هش کلمه عبور که هش کلمه عبور مخلوطی از (کلمه عبور + salt + pepper ) هستش و توسط متد md5 کدگذاری می شه.</p>
			<p>پارامتر اولی کلمه عبور خام است که اگه فقط همین پارامتر اولی وارد بشه خروجی salt و هش کلمه عبور بصورت آرایه خواهد بود.</p>
			<p>پارامتر دومی هم برای تعیین salt استفاده می شه و اگه تعیین بشه متد دیگه بصورت راندوم خودش salt برای کلمه عبور تولید نمی کنه و از salt وارد شده برای تولید هش استفاده می کنه و خروجی هم همین salt و هش شده کلمه عبور بصورت آرایه هست. (مقدار پیش‌فرض null هست)</p>
			<p>پارامتر سوم هم برای تعیین هش شده کلمه عبور هستش و در صورتی که تعیین بشه، هش با salt و کلمه عبور وارد شده توسط پارامتر های دوم و اول چک می شه و در صورت برابری مقدار ۱ برگشت داده می شه و در غیراینصورت مقدار 0 برگشت داده می شه.</p>
			<hr />
			<p>- makePassHashBcrypt برای هش کردن کلمه عبور استفاده می شه و توسط Bcrypt کدگذاری می شه.</p>
			<p>پارامتر اولی کلمه عبور خام است که اگه فقط همین پارامتر اولی وارد بشه خروجی هش کلمه عبور بصورت رشته خواهد بود.</p>
			<p>پارامتر دوم هم برای تعیین هش شده کلمه عبور هستش و در صورتی که تعیین بشه، هش با کلمه عبور وارد شده توسط پارامتر اول چک می شه و در صورت برابری True برگشت داده می شه و در غیراینصورت False برگشت داده می شه.</p>
			<hr />
			<p>- InitPepper برای تعیین pepper (یا همین salt دوم) استفاده می شه که هش کلمه عبور رو قوی‌تر بکنه و برای کل سیستم یکبار تعیین بشه کافیه.</p>
			<p>تنها یک پارامتر داره و برای تعیین pepper استفاده می شه.</p>
			<hr />
			<p>- InitDBHashColumnName با استفاده از این متد نام ستون ای که قراره هش کلمه عبور در دیتابیس ذخیره بشه رو می تونید تعیین کنید.</p>
			<hr />
			<p>- InitSessionCookieParams پارامترهای وارد شده به این متد مستقیماً به تابع session_set_cookie_params ارسال می شن و با استفاده از این متد می تونید پارامتر های کوکی سشن رو تعیین کنید.</p>
			<p>که مهمترین نکته آینه که اگه از این متد استفاده نشه و زمان کوکی سشن تعیین نشه، بعد از بستن مرورگر سشن از بین می ره و سیستم اهراز هویت کاربردی نخواهد داشت و برای زمان برای کوکی بهتره از این متد استفاده بشه.</p>
			<p>پارامتر اول این متد ($lifeTimeParam) برای تعیین زمان برای کوکی سشن به ثانیه است (مثلاً برای 5 ثانیه فقط وارد کنید 5). توجه کنید که اگر مقدار وارد شده عدد باشه همون مقدار مستقیماً وارد تابع مربوطه برای تعیین زمان می شه و در صورتی که مقدار رشته باشه، ابتدا چک می شه که یکی از اینا هست یا نه (day, week, month, year) که اگه یکی از اینا باشه خودش حساب می کنه و برحسب ثانیه مقدار درستش رو تعیین می کنه و دیگه نیاز نیست شما حساب کتاب کنید.</p>
			<p>مثلاً وارد کنید day کوکی سشن به مدت ۱ روز اعتبار خواهد داشت و برای week یک هفته و … .</p>
			<p>پارامتر دوم این متد ($pathParam) برای تعیین آدرسی پوشه ای که قراره کوکی فقط در اون محل معتبر باشه و در صورتی که تعیین نشه مقدار پیش‌فرض ای که php خودش تعیین کرده ست خواهد شد.</p>
			<p>پارامتر سوم ($domainParam) برای تعیین نام دامین ای که کوکی سشن فقط باید در اون معتبر باشه مورد استفاده قرار می گیره و در صورتی که تعیین نشه مقدار پیش‌فرض ای که php خودش تعیین کرده ست خواهد شد.</p>
			<p>پارامتر چهارم ($secureParam) اگه true تعیین بشه از پروتکل ssl استفاده میکنه. و در صورتی که تعیین نشه مقدار پیش‌فرض ای که php خودش تعیین کرده ست خواهد شد.</p>
			<p>پارامتر چهارم ($httponlyParam) هم در صورتی که true تعیین بشه از این روش httponly استفاده می کنه و برای جلوگیری از جملات xss مفید هست بااینکه همه مرورگرها ساپورتش نمی کنن. و در صورتی که تعیین نشه مقدار پیش‌فرض ای که php خودش تعیین کرده ست خواهد شد.</p>
			<p>توجه کنید که همه پارامتر ها به غیر از پارامتر اولی اختیاری هستن.</p>
			<hr />
			<p>- initDBUserIdentifierColumnName این متد برای تعیین نام ستون ای که شناسه یکتای کاربر (مثل نام کاربری، ایمیل، … ) در دیتابیس و درش ذخیره می شه، مورد استفاده قرار می گیره.</p>
			<hr />
			<p>- initDBSaltColumnName این متد برای تعیین نام ستون ای که salt در دیتابیس قراره ذخیره بشه هست.</p>
			<hr />
			<p>- registerNewUser این متد برای ثبت نام بکار می ره و مشخصات کاربر رو در دیتابیس ذخیره می کنه.</p>
			<p>تنها یک پارامتر داره و باید بصورت آرایه باشه و کلید آرایه باید نام ستون جدول دیتابیس باشه و مقدارش هم مقداری که قراره توش ذخیره بشه و محدودتی نداره که آرایه چند تا پارامتر داشته باشه. مثلا:</p>
			<pre class="ltr">
array( 
	'username' => 'hossein', 
	'email' => 'golam@gmail.com', 
	'password_hash' => $password['passHash'], 
	'password_salt' => $password['passSalt'], 
	... 
);
			</pre>
			<p>در صورتی که مقادیر با موفقیت در دیتابیس ذخیره بشن مقدار 1 برگشت داده می شه و در غیراینصورت مقدار 0 برگشت داده می شه.</p>
			<hr />
			<p>- initDbTableName با استفاده از این متد می تونیم نام جدول ای که قراره عملیات روش انجام بشه رو تعیین کنید.</p>
			<hr />
			<p>- initDBSessionIdColumnName با استفاده از این متد نام ستونی که قراره سشن آی دی درش ذخیره بشه رو می شه تعیین کرد.</p>
			<hr />
			<p>- logOut و این متد برای خروج استفاده می شه که در حقیقت سشن ها رو نابود می کنه و تنها یک پارامتر داره و در صورتی که تعیین بشه به آدرس تعیین شده بعد از عملیات حذف سشن منتقل می شه. (مقدار پیش‌فرض این پارامتر null هست) و در صورتی که تعیین نشه فقط سشن ها از بین خواهند رفت.</p>
			<hr />
			<p>- index و در نهایت بخاطر اینکه این کلاس از کلاس baseModel ارث بری کرده و کلاس baseModel هم abstract بود و متد index بصورت abstract تعیین شده است به همین خاطر این متد index در این کلاس بصورت خالی تعیین شده! و کاربردی نداره.</p>
			
			<hr />
			<h5>نکات</h5>
			<p>نکته: توابعی که با پیشوند init شروع می شن برای مقدار دهی اولیه باید استفاده بشن و باید قبل از متدهای دیگه در ابتدا صدا زده بشه و مقدار دهی بشه.</p>
			
			<br />
			<a name="sample" id="sample"></a>
     		<h4>sample/authenticationController.php (نمونه مثال از کلاس)</h4>
     		<p>نحوه کارکرد کلاس بصورت عملی در فایل ای به اسم authenticationController در پوشه sample در کنار کلاس قرار داره و متدهایی همراه توضیحاتشون قرار داده شده که نحوه کارکردشون رو نشون می ده.</p>
      </article>
    </section>

    <footer>
     <p>&copy; Copyright  by Rastgo Framework 2011</p>
    </footer>
  </div>
</body>
</html>